{"version":3,"file":"static/webpack/static\\development\\pages\\books\\[id].js.4f668b3c554e09bb4b48.hot-update.js","sources":["webpack:///./pages/books/.js"],"sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\r\nimport { parseCookies } from \"../../helpers/utils\";\r\nimport axios from \"../../axios-api\";\r\nimport { connect } from \"react-redux\";\r\nimport { useForm } from \"../../hooks\";\r\nimport { CartContext, AuthModalContext } from \"../../store\";\r\n\r\nimport { Row, Col } from \"react-bootstrap\";\r\nimport { ProductDetails, ProductDescription, Comments, ProductsCarousel } from \"../../components/\";\r\n\r\nconst BookPage = ({ bookProps, isAuthorized }) => {\r\n\tconst [ book, setBook ] = useState(bookProps);\r\n\tconst [ rate, setRate ] = useState(0);\r\n\tconst [ isDescriptionExpanded, setIsDescriptionExpanded ] = useState(false);\r\n\tconst cartContext = useContext(CartContext);\r\n\tconst authModalContext = useContext(AuthModalContext);\r\n\tconst commentControl = useForm();\r\n\tuseEffect(\r\n\t\t() => {\r\n\t\t\tsetBook(bookProps);\r\n\t\t},\r\n\t\t[ bookProps ]\r\n\t);\r\n\tconst commentSubmitHandler = event => {\r\n\t\tevent.preventDefault();\r\n\t\tconst formData = new FormData();\r\n\t\tformData.append(\"rate\", rate);\r\n\t\tformData.append(\"text\", commentControl.value);\r\n\t\taxios\r\n\t\t\t.post(`books/${book.id}/feedback`, formData, {\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${parseCookies(null).token}`\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tcommentControl.clear;\r\n\t\t\t\treturn axios.get(\"books/\" + book.id);\r\n\t\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tsetBook(res.data);\r\n\t\t\t})\r\n\t\t\t.catch(err => console.log(err));\r\n\t};\r\n\tconst favouriteHandler = () => {\r\n\t\taxios\r\n\t\t\t.post(`profile/favourites/${book.id}`, null, {\r\n\t\t\t\theaders: {\r\n\t\t\t\t\tAuthorization: `Bearer ${parseCookies(null).token}`\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tconst bookCopy = {\r\n\t\t\t\t\t...book,\r\n\t\t\t\t\tin_favourites: !book.in_favourites\r\n\t\t\t\t};\r\n\t\t\t\tsetBook(bookCopy);\r\n\t\t\t})\r\n\t\t\t.catch(err => {\r\n\t\t\t\tconsole.log(err);\r\n\t\t\t});\r\n\t};\r\n\tconst rateHandler = id => {\r\n\t\tsetRate(id + 1);\r\n\t};\r\n\treturn (\r\n\t\t<Row>\r\n\t\t\t<Col sm={5}>{<ProductDetails {...book} social={null} />}</Col>\r\n\t\t\t<Col sm={7}>\r\n\t\t\t\t<Row>\r\n\t\t\t\t\t<Col md={10}>\r\n\t\t\t\t\t\t<ProductDescription\r\n\t\t\t\t\t\t\t{...book}\r\n\t\t\t\t\t\t\tisDescriptionExpanded={isDescriptionExpanded}\r\n\t\t\t\t\t\t\tcartClicked={() => cartContext.onAddRemoveItem(book)}\r\n\t\t\t\t\t\t\tisInCart={cartContext.onFindInCart(book.id)}\r\n\t\t\t\t\t\t\tfavouriteClicked={favouriteHandler}\r\n\t\t\t\t\t\t\tisAuthorized={isAuthorized}\r\n\t\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t\t<Comments\r\n\t\t\t\t\t\t\titems={book.feedback}\r\n\t\t\t\t\t\t\trate={rate}\r\n\t\t\t\t\t\t\tonSubmit={commentSubmitHandler}\r\n\t\t\t\t\t\t\tcommentControl={commentControl}\r\n\t\t\t\t\t\t\trateClicked={rateHandler}\r\n\t\t\t\t\t\t\tonAuth={authModalContext.authModal.onShow}\r\n\t\t\t\t\t\t\tisAuthorized={isAuthorized}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</Col>\r\n\t\t\t\t</Row>\r\n\t\t\t\t<h3 className=\"mt-5\">Также вас может заинтересовать</h3>\r\n\t\t\t\t<ProductsCarousel items={book.related} responsive={{ lg: 4 }} />\r\n\t\t\t</Col>\r\n\t\t</Row>\r\n\t);\r\n};\r\n\r\nexport const getServerSideProps = async ({ query, req }) => {\r\n\tconst token = parseCookies(req).token;\r\n\tconst res = await axios.get(\"books/\" + query.id, {\r\n\t\theaders: token\r\n\t\t\t? {\r\n\t\t\t\t\tAuthorization: `Bearer ${token}`\r\n\t\t\t\t}\r\n\t\t\t: null\r\n\t});\r\n\treturn {\r\n\t\tprops: {\r\n\t\t\tbookProps: res.data\r\n\t\t}\r\n\t};\r\n};\r\nconst mapStateToProps = state => {\r\n\treturn {\r\n\t\tisAuthorized: state.auth.token !== null\r\n\t};\r\n};\r\nexport default connect(mapStateToProps)(BookPage);\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AADA;AADA;AAMA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAEA;AACA;AADA;AADA;AAMA;AAEA;AAFA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AAgBA;AACA;AACA;AADA;AAGA;AACA;;AAAA;;;;A","sourceRoot":""}